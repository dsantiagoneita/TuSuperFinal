<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/layout :: head('TuSuper - Checkout')}"></head>

<body class="theme-usuario">
    <nav th:replace="~{fragments/layout :: navbar}"></nav>

    <div class="container py-4">
        <div th:replace="~{fragments/layout :: alerts}"></div>

        <h2 class="mb-4"><i class="bi bi-bag-check"></i> Finalizar Pedido</h2>

        <div class="row">
            <div class="col-md-8">
                <form th:action="@{/usuario/pedido/crear}" method="post">
                    <div class="card mb-4">
                        <div class="card-header bg-white">
                            <h5 class="mb-0"><i class="bi bi-geo-alt"></i> Dirección de Entrega</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Dirección completa</label>
                                <input type="text" class="form-control" name="direccionEntrega"
                                    th:value="${usuario.direccion}" required
                                    placeholder="Calle, número, barrio, ciudad">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Observaciones (opcional)</label>
                                <textarea class="form-control" name="observaciones" rows="2"
                                    placeholder="Instrucciones especiales para la entrega..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Notas Adicionales</label>
                                <textarea class="form-control" name="notasAdicionales" rows="2"
                                    placeholder="Cualquier otro detalle que quieras agregar..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header bg-white">
                            <h5 class="mb-0"><i class="bi bi-credit-card"></i> Método de Pago</h5>
                        </div>
                        <div class="card-body">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="metodoPago" id="efectivo"
                                    value="efectivo" checked>
                                <label class="form-check-label" for="efectivo">
                                    <i class="bi bi-cash"></i> Pago en efectivo contra entrega
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="metodoPago" id="transferencia"
                                    value="transferencia" disabled>
                                <label class="form-check-label text-muted" for="transferencia">
                                    <i class="bi bi-bank"></i> Transferencia bancaria (próximamente)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="metodoPago" id="tarjeta"
                                    value="tarjeta" disabled>
                                <label class="form-check-label text-muted" for="tarjeta">
                                    <i class="bi bi-credit-card-2-front"></i> Tarjeta de crédito/débito (próximamente)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header bg-white">
                            <h5 class="mb-0"><i class="bi bi-list-check"></i> Resumen del Pedido</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm">
                                <tbody>
                                    <tr th:each="entry : ${items}">
                                        <td th:text="${entry.value.producto.nombre}">Producto</td>
                                        <td class="text-center" th:text="'x' + ${entry.value.cantidad}">x1</td>
                                        <td class="text-end precio"
                                            th:text="'$' + ${#numbers.formatDecimal(entry.value.subtotal, 0, 'COMMA', 0, 'POINT')}">
                                            $0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="card-footer bg-white">
                            <button type="submit" class="btn btn-tusuper w-100 py-3">
                                <i class="bi bi-check-circle"></i> Confirmar Pedido -
                                <strong
                                    th:text="'$' + ${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' COP'">$0</strong>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-md-4">
                <div class="card sticky-top" style="top: 20px;">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-receipt"></i> Total a Pagar</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal</span>
                            <span th:text="'$' + ${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')}">$0</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Envío</span>
                            <span class="text-success">Gratis</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <strong>Total</strong>
                            <strong class="precio fs-3"
                                th:text="'$' + ${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' COP'">$0</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block th:replace="~{fragments/layout :: footer}"></th:block>
</body>

</html>
